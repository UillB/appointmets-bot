<div class="ai-config-container">
  <div class="header">
    <h1>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</h1>
    <p>–ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º –≤ Telegram –±–æ—Ç–µ</p>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ AI...</p>
  </div>

  <div *ngIf="!isLoading" class="config-content">
    <mat-card class="config-card">
      <mat-card-header>
        <mat-card-title>ü§ñ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</mat-card-title>
        <mat-card-subtitle>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="aiConfigForm" class="config-form">
          
          <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
          <div class="form-section">
            <h3>‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>–ü—Ä–æ–≤–∞–π–¥–µ—Ä AI</mat-label>
                <mat-select formControlName="provider" (selectionChange)="onProviderChange()">
                  <mat-option *ngFor="let provider of providers" [value]="provider.value">
                    {{ provider.icon }} {{ provider.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>API –ö–ª—é—á</mat-label>
                <input matInput formControlName="apiKey" type="password" placeholder="sk-...">
                <mat-hint>–í–∞—à API –∫–ª—é—á –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞</mat-hint>
              </mat-form-field>
              <button mat-stroked-button 
                      type="button" 
                      (click)="validateApiKey()" 
                      [disabled]="isValidatingApiKey || !aiConfigForm.get('apiKey')?.value">
                <mat-spinner *ngIf="isValidatingApiKey" diameter="20"></mat-spinner>
                <mat-icon *ngIf="!isValidatingApiKey">check_circle</mat-icon>
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á
              </button>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>–ú–æ–¥–µ–ª—å</mat-label>
                <mat-select formControlName="model">
                  <mat-option *ngFor="let model of availableModels" [value]="model.id">
                    {{ model.name }}
                    <span *ngIf="model.description" class="model-description"> - {{ model.description }}</span>
                  </mat-option>
                </mat-select>
                <mat-hint>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</mat-hint>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>–ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤</mat-label>
                <input matInput formControlName="maxTokens" type="number" min="100" max="4000">
                <mat-hint>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞</mat-hint>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</mat-label>
                <input matInput formControlName="temperature" type="number" min="0" max="2" step="0.1">
                <mat-hint>–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ (0-2)</mat-hint>
              </mat-form-field>
            </div>
          </div>

          <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
          <div class="form-section">
            <h3>üí¨ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI</h3>
            <p class="section-description">
              –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞. 
              –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å–ª—É–≥–∞—Ö, –∑–∞–ø–∏—Å—å, –æ—Ç–º–µ–Ω–∞) —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
            </p>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>–í–∞—à–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</mat-label>
              <textarea matInput 
                        formControlName="customPrompt" 
                        rows="6"
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Å–∫–∏–¥–∫—É 10% –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."></textarea>
              <mat-hint>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</mat-hint>
            </mat-form-field>
          </div>

          <!-- –í–∫–ª—é—á–µ–Ω–∏–µ AI -->
          <div class="form-section">
            <h3>üéØ –ê–∫—Ç–∏–≤–∞—Ü–∏—è</h3>
            <div class="form-row">
              <mat-slide-toggle formControlName="enabled" color="primary">
                –í–∫–ª—é—á–∏—Ç—å AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
              </mat-slide-toggle>
              <p class="toggle-description">
                –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –≤ Telegram –±–æ—Ç–µ
              </p>
            </div>
          </div>

        </form>
      </mat-card-content>
    </mat-card>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
    <mat-card *ngIf="usageStats && usageStats.totalRequests > 0" class="stats-card">
      <mat-card-header>
        <mat-card-title>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</mat-card-title>
        <mat-card-subtitle>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div *ngIf="isLoadingStats" class="loading-stats">
          <mat-spinner diameter="40"></mat-spinner>
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
        </div>
        
        <div *ngIf="!isLoadingStats && usageStats" class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ usageStats.totalRequests || 0 }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{ formatTokens(usageStats.totalTokens) }}</div>
            <div class="stat-label">–¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{ (usageStats.averageTokensPerRequest || 0) | number:'1.0-0' }}</div>
            <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ —Ç–æ–∫–µ–Ω–æ–≤/–∑–∞–ø—Ä–æ—Å</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="action-buttons">
      <button mat-raised-button 
              color="accent" 
              (click)="testAI()" 
              [disabled]="isTestingAI || aiConfigForm.invalid">
        <mat-spinner *ngIf="isTestingAI" diameter="20"></mat-spinner>
        <mat-icon *ngIf="!isTestingAI">play_arrow</mat-icon>
        –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI
      </button>

      <button mat-raised-button 
              color="primary" 
              (click)="saveConfig()" 
              [disabled]="isSaving || aiConfigForm.invalid">
        <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
        <mat-icon *ngIf="!isSaving">save</mat-icon>
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
      </button>
    </div>
  </div>
</div>
