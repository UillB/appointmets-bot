<div class="dashboard-container">
  <!-- Welcome Section -->
  <div class="welcome-section">
    <h1>Welcome back, {{ currentUser?.name }}! üëã</h1>
    <h2>{{ currentDate | date:'EEEE, MMMM d, y' }}</h2>
  </div>

  <!-- Quick Access Cards -->
  <div class="quick-access-section">
    <div class="quick-access-grid">
      <div class="quick-access-card" (click)="navigateTo('/appointments')">
        <div class="card-icon">
          <mat-icon>event</mat-icon>
        </div>
        <div class="card-content">
          <h3>Appointments</h3>
          <p>Manage bookings</p>
        </div>
        <div class="card-badge">
          <span class="badge-text">{{ stats.todayAppointments }} today</span>
        </div>
        <mat-icon class="card-arrow">arrow_forward_ios</mat-icon>
      </div>

      <div class="quick-access-card" (click)="navigateTo('/services')">
        <div class="card-icon">
          <mat-icon>build</mat-icon>
        </div>
        <div class="card-content">
          <h3>Services</h3>
          <p>Configure offerings</p>
        </div>
        <div class="card-badge">
          <span class="badge-text">{{ stats.totalServices }} available</span>
        </div>
        <mat-icon class="card-arrow">arrow_forward_ios</mat-icon>
      </div>

      <div class="quick-access-card" (click)="navigateTo('/organizations')">
        <div class="card-icon">
          <mat-icon>business</mat-icon>
        </div>
        <div class="card-content">
          <h3>Organizations</h3>
          <p>Manage locations</p>
        </div>
        <div class="card-badge">
          <span class="badge-text">1 active</span>
        </div>
        <mat-icon class="card-arrow">arrow_forward_ios</mat-icon>
      </div>

      <div class="quick-access-card" (click)="navigateTo('/settings')">
        <div class="card-icon">
          <mat-icon>settings</mat-icon>
        </div>
        <div class="card-content">
          <h3>Settings</h3>
          <p>System configuration</p>
        </div>
        <div class="card-badge">
          <button mat-stroked-button class="account-btn">Account</button>
        </div>
        <mat-icon class="card-arrow">arrow_forward_ios</mat-icon>
      </div>
    </div>
  </div>

  <!-- Statistics & Overview Section -->
  <div class="statistics-section" *ngIf="!loading; else loadingTemplate">
    <div class="section-header">
      <h2>Statistics & Overview</h2>
      <a href="#" class="view-all-link">View All ‚Üí</a>
    </div>
    
    <div class="statistics-grid">
      <div class="stat-card" (click)="onStatClick('totalAppointments')">
        <div class="stat-icon">
          <mat-icon>event</mat-icon>
        </div>
        <div class="stat-content">
          <h3>Total Appointments</h3>
          <div class="stat-number">{{ stats.totalAppointments }}</div>
          <div class="stat-description">vs last week</div>
        </div>
        <div class="stat-trend trend-up">
          <mat-icon>trending_up</mat-icon>
          <span>12%</span>
        </div>
      </div>

      <div class="stat-card" (click)="onStatClick('todayAppointments')">
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
        <div class="stat-content">
          <h3>Today's Bookings</h3>
          <div class="stat-number">{{ stats.todayAppointments }}</div>
          <div class="stat-description">Scheduled for today</div>
        </div>
        <div class="stat-trend trend-up">
          <mat-icon>trending_up</mat-icon>
          <span>12%</span>
        </div>
      </div>

      <div class="stat-card" (click)="onStatClick('pendingAppointments')">
        <div class="stat-icon">
          <mat-icon>error_outline</mat-icon>
        </div>
        <div class="stat-content">
          <h3>Pending Approvals</h3>
          <div class="stat-number">{{ stats.pendingAppointments }}</div>
          <div class="stat-description">Awaiting confirmation</div>
        </div>
        <div class="stat-trend trend-neutral">
          <mat-icon>remove</mat-icon>
          <span>0%</span>
        </div>
      </div>

      <div class="stat-card" (click)="onStatClick('totalServices')">
        <div class="stat-icon">
          <mat-icon>build</mat-icon>
        </div>
        <div class="stat-content">
          <h3>Active Services</h3>
          <div class="stat-number">{{ stats.totalServices }}</div>
          <div class="stat-description">Available for booking</div>
        </div>
        <div class="stat-trend trend-up">
          <mat-icon>trending_up</mat-icon>
          <span>5%</span>
        </div>
      </div>
    </div>
  </div>

  <ng-template #loadingTemplate>
    <div class="skeleton-loading">
      <div class="statistics-grid">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4]">
          <div class="skeleton-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-content">
              <div class="skeleton-title"></div>
              <div class="skeleton-subtitle"></div>
            </div>
          </div>
          <div class="skeleton-stats">
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <!-- Bottom Section: Calendar and Upcoming Appointments -->
  <div class="bottom-section">
    <!-- Calendar Widget (Left) -->
    <div class="calendar-widget">
      <div class="widget-header">
        <mat-icon>calendar_month</mat-icon>
        <h3>Calendar</h3>
      </div>
      <div class="calendar-content">
        <mat-calendar 
          [selected]="selectedDate"
          (selectedChange)="onDateSelected($event)"
          class="dashboard-calendar">
        </mat-calendar>
      </div>
    </div>

    <!-- Upcoming Appointments (Right) -->
    <div class="upcoming-appointments">
      <div class="widget-header">
        <mat-icon>schedule</mat-icon>
        <h3>{{ getSelectedDateHeader() }}</h3>
        <button mat-raised-button color="primary" class="new-appointment-btn" (click)="navigateTo('/appointments')">
          New Appointment
        </button>
      </div>
      <div class="appointments-list">
        <!-- Real appointments from backend -->
        <div *ngIf="recentAppointments.length === 0" class="no-appointments">
          <mat-icon>event_busy</mat-icon>
          <p>No appointments scheduled</p>
        </div>
        
        <div *ngFor="let appointment of recentAppointments" class="appointment-item">
          <div class="appointment-icon">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="appointment-content">
            <div class="appointment-title">{{ getServiceName(appointment.service) }}</div>
            <div class="appointment-client">{{ getClientName(appointment) }}</div>
            <div class="appointment-time">{{ formatAppointmentTime(appointment) }}</div>
          </div>
          <div class="appointment-status">
            <span class="status-badge" [ngClass]="getAppointmentStatusClass(appointment.status)">
              {{ getStatusText(appointment.status) }}
            </span>
          </div>
          <mat-icon class="appointment-arrow">arrow_forward_ios</mat-icon>
        </div>
      </div>
    </div>
  </div>


  <!-- API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
  <div class="api-test-section" style="display: none;">
    <h2>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h2>
    <app-api-test></app-api-test>
  </div>
</div>
