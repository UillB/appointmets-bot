<div class="organizations-container">
  <!-- Universal Header with DateTime and Refresh -->
  <app-universal-header></app-universal-header>
  
  <div class="page-header">
    <div class="page-title">
      <mat-icon class="title-icon">business</mat-icon>
      <div class="title-content">
        <h1>{{ 'organizations.title' | translate }}</h1>
        <p class="page-description">{{ 'organizations.subtitle' | translate }}</p>
      </div>
    </div>
    
    <button 
      *ngIf="isSuperAdmin" 
      mat-raised-button 
      color="primary" 
      (click)="onCreateOrganization()"
      class="create-button">
      <mat-icon>add</mat-icon>
      {{ 'organizations.create' | translate }}
    </button>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <button mat-stroked-button (click)="refreshOrganizations()" class="quick-action-btn">
      <mat-icon>refresh</mat-icon>
      Обновить
    </button>
    <button mat-stroked-button (click)="exportOrganizations()" class="quick-action-btn">
      <mat-icon>download</mat-icon>
      Экспорт
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Поиск</mat-label>
        <input matInput [(ngModel)]="searchQuery" (input)="onSearchChange()" placeholder="Название организации...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Сортировка</mat-label>
        <mat-select [(ngModel)]="sortBy" (selectionChange)="onSortChange()">
          <mat-option value="name">По названию</mat-option>
          <mat-option value="createdAt">По дате создания</mat-option>
          <mat-option value="users">По количеству пользователей</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-stroked-button (click)="clearFilters()" class="clear-filters-btn">
        <mat-icon>clear</mat-icon>
        Очистить фильтры
      </button>
    </div>
  </div>

  <div class="organizations-content">
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner></mat-spinner>
      <p>{{ 'common.loading' | translate }}</p>
    </div>

    <div *ngIf="!isLoading && organizations.length === 0" class="empty-state">
      <mat-icon class="empty-icon">business</mat-icon>
      <h3>{{ 'organizations.empty.title' | translate }}</h3>
      <p>{{ 'organizations.empty.message' | translate }}</p>
      <button 
        *ngIf="isSuperAdmin" 
        mat-raised-button 
        color="primary" 
        (click)="onCreateOrganization()">
        <mat-icon>add</mat-icon>
        {{ 'organizations.create' | translate }}
      </button>
    </div>

    <!-- Desktop Grid View -->
    <div *ngIf="!isLoading && organizations.length > 0" class="organizations-grid desktop-view">
      <mat-card *ngFor="let organization of organizations" class="organization-card">
        <mat-card-header>
          <div mat-card-avatar class="organization-avatar">
            <img [src]="getAvatarUrl(organization)" [alt]="organization.name">
          </div>
          <mat-card-title>{{ organization.name }}</mat-card-title>
          <mat-card-subtitle>
            {{ organization._count?.users || 0 }} {{ 'organizations.users' | translate }} • 
            {{ organization._count?.services || 0 }} {{ 'organizations.services' | translate }}
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="organization-stats">
            <div class="stat-item">
              <mat-icon>people</mat-icon>
              <span>{{ organization._count?.users || 0 }}</span>
            </div>
            <div class="stat-item">
              <mat-icon>business_center</mat-icon>
              <span>{{ organization._count?.services || 0 }}</span>
            </div>
            <div class="stat-item">
              <mat-icon>calendar_today</mat-icon>
              <span>{{ formatDate(organization.createdAt) }}</span>
            </div>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <button mat-button (click)="onViewOrganization(organization)">
            <mat-icon>visibility</mat-icon>
            {{ 'common.view' | translate }}
          </button>
          <button mat-button (click)="onEditOrganization(organization)">
            <mat-icon>edit</mat-icon>
            {{ 'common.edit' | translate }}
          </button>
          <button 
            *ngIf="isSuperAdmin" 
            mat-button 
            color="warn" 
            (click)="onDeleteOrganization(organization)">
            <mat-icon>delete</mat-icon>
            {{ 'common.delete' | translate }}
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Mobile Cards View -->
    <div *ngIf="!isLoading && organizations.length > 0" class="mobile-organizations mobile-view">
      <div class="mobile-organization-card" *ngFor="let organization of organizations">
        <div class="card-header">
          <div class="organization-info">
            <div class="organization-avatar">
              <img [src]="getAvatarUrl(organization)" [alt]="organization.name">
            </div>
            <div class="organization-details">
              <h3 class="organization-name">{{ organization.name }}</h3>
              <div class="organization-meta">
                <span class="users-count">{{ organization._count?.users || 0 }} пользователей</span>
                <span class="services-count">{{ organization._count?.services || 0 }} услуг</span>
              </div>
            </div>
          </div>
          <div class="organization-date">
            {{ formatDate(organization.createdAt) }}
          </div>
        </div>
        
        <div class="card-content">
          <div class="stats-row">
            <div class="stat-item">
              <mat-icon>people</mat-icon>
              <span>{{ organization._count?.users || 0 }}</span>
            </div>
            <div class="stat-item">
              <mat-icon>business_center</mat-icon>
              <span>{{ organization._count?.services || 0 }}</span>
            </div>
            <div class="stat-item">
              <mat-icon>calendar_today</mat-icon>
              <span>{{ formatDate(organization.createdAt) }}</span>
            </div>
          </div>
        </div>
        
        <div class="card-actions">
          <button mat-stroked-button (click)="onViewOrganization(organization)" class="action-btn">
            <mat-icon>visibility</mat-icon>
            Просмотр
          </button>
          <button mat-stroked-button (click)="onEditOrganization(organization)" class="action-btn">
            <mat-icon>edit</mat-icon>
            Редактировать
          </button>
          <button 
            *ngIf="isSuperAdmin" 
            mat-stroked-button 
            color="warn" 
            (click)="onDeleteOrganization(organization)" 
            class="action-btn">
            <mat-icon>delete</mat-icon>
            Удалить
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
