<div class="bot-token-input-container">
  <mat-card class="token-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>vpn_key</mat-icon>
        Активация бота
      </mat-card-title>
      <mat-card-subtitle>
        Введите токен вашего Telegram бота для активации
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="tokenForm" (ngSubmit)="validateToken()" class="token-form">
        <!-- Поле ввода токена -->
        <mat-form-field appearance="outline" class="token-field">
          <mat-label>Токен бота</mat-label>
          <input 
            matInput 
            formControlName="token"
            [type]="showToken ? 'text' : 'password'"
            placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
            autocomplete="off">
          
          <!-- Кнопка показать/скрыть токен -->
          <button 
            mat-icon-button 
            matSuffix 
            type="button"
            (click)="toggleTokenVisibility()"
            [attr.aria-label]="showToken ? 'Скрыть токен' : 'Показать токен'">
            <mat-icon>{{ showToken ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>

          <!-- Кнопка копирования -->
          <button 
            mat-icon-button 
            matSuffix 
            type="button"
            (click)="copyToken()"
            [disabled]="!tokenForm.get('token')?.value"
            matTooltip="Копировать токен">
            <mat-icon>content_copy</mat-icon>
          </button>

          <!-- Сообщение об ошибке -->
          <mat-error *ngIf="getFieldError('token')">
            {{ getFieldError('token') }}
          </mat-error>
        </mat-form-field>

        <!-- Информация о формате токена -->
        <div class="token-info">
          <mat-icon>info</mat-icon>
          <p>
            Токен имеет формат: <code>123456789:ABCdefGHIjklMNOpqrsTUVwxyz</code><br>
            Получите его у @BotFather после создания бота
          </p>
        </div>

        <!-- Кнопки действий -->
        <div class="action-buttons">
          <button 
            mat-raised-button 
            color="primary" 
            type="submit"
            [disabled]="!canValidateToken()"
            class="validate-button">
            <mat-icon *ngIf="!isValidating">{{ getValidationIcon() }}</mat-icon>
            <mat-spinner *ngIf="isValidating" diameter="20"></mat-spinner>
            <span *ngIf="!isValidating">Проверить токен</span>
            <span *ngIf="isValidating">Проверка...</span>
          </button>

          <button 
            mat-stroked-button 
            type="button"
            (click)="clearForm()"
            class="clear-button">
            <mat-icon>clear</mat-icon>
            Очистить
          </button>
        </div>
      </form>

      <!-- Результат валидации -->
      <div class="validation-result" *ngIf="validationResult">
        <mat-card [ngClass]="'result-card ' + validationResult">
          <mat-card-content>
            <div class="result-content">
              <mat-icon [color]="getValidationColor()">{{ getValidationIcon() }}</mat-icon>
              
              <div class="result-text" *ngIf="validationResult === 'success'">
                <h3>Токен валиден!</h3>
                <div class="bot-info" *ngIf="botInfo">
                  <p><strong>Имя бота:</strong> {{ botInfo.first_name }}</p>
                  <p><strong>Username:</strong> @{{ botInfo.username }}</p>
                  <p><strong>ID:</strong> {{ botInfo.id }}</p>
                  <div class="bot-capabilities">
                    <mat-chip-listbox>
                      <mat-chip *ngIf="botInfo.can_join_groups" color="primary" selected>
                        Может присоединяться к группам
                      </mat-chip>
                      <mat-chip *ngIf="botInfo.can_read_all_group_messages" color="accent" selected>
                        Читает сообщения в группах
                      </mat-chip>
                      <mat-chip *ngIf="botInfo.supports_inline_queries" color="warn" selected>
                        Поддерживает inline запросы
                      </mat-chip>
                    </mat-chip-listbox>
                  </div>
                </div>
              </div>

              <div class="result-text" *ngIf="validationResult === 'error'">
                <h3>Ошибка валидации</h3>
                <p>Токен недействителен или уже используется другой организацией.</p>
                <p>Проверьте правильность ввода токена.</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Кнопка активации -->
      <div class="activation-section" *ngIf="validationResult === 'success'">
        <mat-card class="activation-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>rocket_launch</mat-icon>
              Активация бота
            </mat-card-title>
            <mat-card-subtitle>
              Нажмите кнопку ниже для активации бота в вашей организации
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="activation-info">
              <p>После активации бот будет:</p>
              <ul>
                <li>Настроен с базовыми командами</li>
                <li>Подключен к системе записи</li>
                <li>Готов к приему клиентов</li>
              </ul>
            </div>

            <button 
              mat-raised-button 
              color="accent" 
              size="large"
              (click)="activateBot()"
              [disabled]="!canActivateBot()"
              class="activate-button">
              <mat-icon *ngIf="!isActivating">rocket_launch</mat-icon>
              <mat-spinner *ngIf="isActivating" diameter="20"></mat-spinner>
              <span *ngIf="!isActivating">Активировать бота</span>
              <span *ngIf="isActivating">Активация...</span>
            </button>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Дополнительная информация -->
  <mat-card class="help-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>help_outline</mat-icon>
        Нужна помощь?
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="help-content">
        <div class="help-item">
          <mat-icon>security</mat-icon>
          <div>
            <h4>Безопасность</h4>
            <p>Токен бота - это ключ к управлению. Никогда не делитесь им с посторонними.</p>
          </div>
        </div>

        <div class="help-item">
          <mat-icon>refresh</mat-icon>
          <div>
            <h4>Новый токен</h4>
            <p>Если токен скомпрометирован, создайте новый через @BotFather командой /revoke.</p>
          </div>
        </div>

        <div class="help-item">
          <mat-icon>support_agent</mat-icon>
          <div>
            <h4>Поддержка</h4>
            <p>Если возникли проблемы, обратитесь к @BotFather или в службу поддержки.</p>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
