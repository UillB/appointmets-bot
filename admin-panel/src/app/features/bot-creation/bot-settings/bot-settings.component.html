<div class="bot-settings-container">
  <!-- Статус бота -->
  <mat-card class="status-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>info</mat-icon>
        Статус бота
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <div class="status-content" *ngIf="botStatus?.botStatus">
        <div class="status-item">
          <mat-icon [color]="getBotStatusColor()">circle</mat-icon>
          <span class="status-text">{{ getBotStatusText() }}</span>
        </div>
        
        <div class="status-item" *ngIf="botStatus?.botStatus?.username">
          <mat-icon>person</mat-icon>
          <span class="status-text">@{{ botStatus?.botStatus?.username }}</span>
        </div>
        
        <div class="status-item" *ngIf="botStatus?.botStatus?.botLink">
          <mat-icon>link</mat-icon>
          <span class="status-text">{{ botStatus?.botStatus?.botLink }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Основные настройки -->
  <mat-card class="settings-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>settings</mat-icon>
        Основные настройки
      </mat-card-title>
      <mat-card-subtitle>
        Настройте имя и описание вашего бота
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="settingsForm" (ngSubmit)="updateBotSettings()" class="settings-form">
        <!-- Имя бота -->
        <mat-form-field appearance="outline" class="name-field">
          <mat-label>Имя бота</mat-label>
          <input 
            matInput 
            formControlName="name"
            placeholder="Введите имя бота"
            maxlength="64">
          <mat-hint align="end">{{ settingsForm.get('name')?.value?.length || 0 }}/64</mat-hint>
          <mat-error *ngIf="getFieldError('name')">
            {{ getFieldError('name') }}
          </mat-error>
        </mat-form-field>

        <!-- Описание бота -->
        <mat-form-field appearance="outline" class="description-field">
          <mat-label>Описание бота</mat-label>
          <textarea 
            matInput 
            formControlName="description"
            placeholder="Введите описание бота"
            rows="4"
            maxlength="512">
          </textarea>
          <mat-hint align="end">{{ settingsForm.get('description')?.value?.length || 0 }}/512</mat-hint>
          <mat-error *ngIf="getFieldError('description')">
            {{ getFieldError('description') }}
          </mat-error>
        </mat-form-field>

        <!-- Кнопка обновления -->
        <div class="update-section">
          <button 
            mat-raised-button 
            color="primary" 
            type="submit"
            [disabled]="!canUpdateSettings()"
            class="update-button">
            <mat-icon *ngIf="!isUpdating">save</mat-icon>
            <mat-spinner *ngIf="isUpdating" diameter="20"></mat-spinner>
            <span *ngIf="!isUpdating">Обновить настройки</span>
            <span *ngIf="isUpdating">Обновление...</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Ссылка на бота и шаринг -->
  <mat-card class="sharing-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>share</mat-icon>
        Поделиться ботом
      </mat-card-title>
      <mat-card-subtitle>
        Поделитесь ссылкой на вашего бота с клиентами
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="sharing-content">
        <!-- Ссылка на бота -->
        <div class="bot-link-section" *ngIf="botLink">
          <mat-form-field appearance="outline" class="link-field">
            <mat-label>Ссылка на бота</mat-label>
            <input 
              matInput 
              [value]="botLink"
              readonly>
            <button 
              mat-icon-button 
              matSuffix 
              (click)="copyBotLink()"
              matTooltip="Копировать ссылку">
              <mat-icon>content_copy</mat-icon>
            </button>
          </mat-form-field>
        </div>

        <!-- QR-код -->
        <div class="qr-section">
          <app-qr-code-generator 
            [data]="botLink"
            [size]="200"
            [showDownloadButton]="true"
            [showShareButton]="true">
          </app-qr-code-generator>
        </div>

        <!-- Кнопки шаринга -->
        <div class="sharing-buttons">
          <button 
            mat-raised-button 
            color="primary"
            (click)="shareBot()"
            class="share-button">
            <mat-icon>share</mat-icon>
            Поделиться
          </button>
          
          <button 
            mat-stroked-button
            (click)="copyBotLink()"
            class="copy-button">
            <mat-icon>content_copy</mat-icon>
            Копировать ссылку
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Информация о боте -->
  <mat-card class="info-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>info_outline</mat-icon>
        Информация о боте
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="info-content" *ngIf="botStatus?.botStatus">
        <div class="info-item">
          <mat-icon>person</mat-icon>
          <div class="info-text">
            <h4>Имя бота</h4>
            <p>{{ botStatus?.botStatus?.firstName || 'Не установлено' }}</p>
          </div>
        </div>

        <div class="info-item">
          <mat-icon>alternate_email</mat-icon>
          <div class="info-text">
            <h4>Username</h4>
            <p>@{{ botStatus?.botStatus?.username || 'Не установлено' }}</p>
          </div>
        </div>

        <div class="info-item">
          <mat-icon>group</mat-icon>
          <div class="info-text">
            <h4>Возможности</h4>
            <div class="capabilities">
              <mat-chip-listbox>
                <mat-chip 
                  *ngIf="botStatus?.botStatus?.canJoinGroups" 
                  color="primary" 
                  selected>
                  Может присоединяться к группам
                </mat-chip>
                <mat-chip 
                  *ngIf="botStatus?.botStatus?.canReadAllGroupMessages" 
                  color="accent" 
                  selected>
                  Читает сообщения в группах
                </mat-chip>
                <mat-chip 
                  *ngIf="botStatus?.botStatus?.supportsInlineQueries" 
                  color="warn" 
                  selected>
                  Поддерживает inline запросы
                </mat-chip>
              </mat-chip-listbox>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Дополнительные настройки -->
  <mat-card class="advanced-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>tune</mat-icon>
        Дополнительные настройки
      </mat-card-title>
      <mat-card-subtitle>
        Расширенные возможности настройки бота
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="advanced-content">
        <div class="advanced-item">
          <mat-icon>photo_camera</mat-icon>
          <div class="advanced-text">
            <h4>Аватар бота</h4>
            <p>Загрузите изображение для аватара бота</p>
            <button mat-stroked-button disabled>
              <mat-icon>upload</mat-icon>
              Загрузить аватар
            </button>
            <small>Функция будет доступна в следующей версии</small>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="advanced-item">
          <mat-icon>terminal</mat-icon>
          <div class="advanced-text">
            <h4>Команды бота</h4>
            <p>Настройте команды и их описания</p>
            <button mat-stroked-button disabled>
              <mat-icon>edit</mat-icon>
              Настроить команды
            </button>
            <small>Функция будет доступна в следующей версии</small>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="advanced-item">
          <mat-icon>web</mat-icon>
          <div class="advanced-text">
            <h4>Telegram Web App</h4>
            <p>Интеграция с веб-приложением для управления</p>
            
            <!-- WebApp URL -->
            <div class="webapp-url-section" *ngIf="webAppUrl">
              <mat-form-field appearance="outline" class="webapp-url-field">
                <mat-label>WebApp URL</mat-label>
                <input 
                  matInput 
                  [value]="webAppUrl"
                  readonly>
                <button 
                  mat-icon-button 
                  matSuffix 
                  (click)="copyWebAppUrl()"
                  matTooltip="Копировать WebApp URL">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </mat-form-field>
              
              <div class="webapp-actions">
                <button 
                  mat-raised-button 
                  color="primary"
                  (click)="openWebApp()"
                  class="open-webapp-button">
                  <mat-icon>launch</mat-icon>
                  Открыть WebApp
                </button>
              </div>
            </div>
            
            <div class="webapp-placeholder" *ngIf="!webAppUrl">
              <p>WebApp URL будет доступен после активации бота</p>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
