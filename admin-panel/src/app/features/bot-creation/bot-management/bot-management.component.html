<div class="bot-management-container">
  <!-- Universal Header -->
  <div class="universal-header">
    <div class="datetime-info">
      <div class="current-date">{{ currentDate | date:'EEEE, d MMMM y' }}</div>
      <div class="current-time">{{ currentTime | date:'HH:mm:ss' }}</div>
    </div>
    <button mat-icon-button 
            color="primary" 
            (click)="onRefresh()" 
            [disabled]="isLoading" 
            class="refresh-btn"
            [attr.aria-label]="'Обновить данные'">
      <mat-icon>refresh</mat-icon>
    </button>
  </div>

  <div class="page-header">
    <div class="page-title">
      <mat-icon class="title-icon">smart_toy</mat-icon>
      <div class="title-content">
        <h1>Управление ботом</h1>
        <p class="page-description">Создайте и настройте Telegram бота для автоматической записи клиентов</p>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <button mat-stroked-button (click)="onRefresh()" class="quick-action-btn">
      <mat-icon>refresh</mat-icon>
      Обновить статус
    </button>
    <button mat-stroked-button (click)="onExportBotData()" class="quick-action-btn">
      <mat-icon>download</mat-icon>
      Экспорт данных
    </button>
    <button mat-stroked-button (click)="onOpenHelp()" class="quick-action-btn">
      <mat-icon>help</mat-icon>
      Помощь
    </button>
  </div>

  <div class="content">
    <!-- Гайд после создания бота -->
    <div *ngIf="showPostCreationGuide" class="post-creation-guide">
      <app-post-bot-creation-guide
        [organizationId]="organizationId"
        [botUsername]="activatedBotUsername"
        (guideCompleted)="onPostCreationGuideCompleted()"
        (skipGuide)="onPostCreationGuideSkipped()">
      </app-post-bot-creation-guide>
    </div>

    <!-- Bot Status Overview -->
    <div class="bot-status-overview" *ngIf="!showPostCreationGuide">
      <div class="status-cards">
        <div class="status-card" [ngClass]="getBotStatusClass()">
          <div class="card-icon">
            <mat-icon>{{ getBotStatusIcon() }}</mat-icon>
          </div>
          <div class="card-content">
            <h3>{{ getBotStatusTitle() }}</h3>
            <p>{{ getBotStatusDescription() }}</p>
          </div>
        </div>
        
        <div class="status-card info">
          <div class="card-icon">
            <mat-icon>business</mat-icon>
          </div>
          <div class="card-content">
            <h3>Организация</h3>
            <p>{{ organizationName }}</p>
          </div>
        </div>
        
        <div class="status-card info" *ngIf="botActivated">
          <div class="card-icon">
            <mat-icon>link</mat-icon>
          </div>
          <div class="card-content">
            <h3>Ссылка на бота</h3>
            <p>https://t.me/{{ activatedBotUsername }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-section" *ngIf="!showPostCreationGuide">
      <div class="progress-header">
        <h3>Прогресс настройки бота</h3>
        <span class="progress-text">{{ getProgressText() }}</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
      </div>
    </div>

    <!-- Основные вкладки управления ботом -->
    <mat-tab-group 
      *ngIf="!showPostCreationGuide"
      [(selectedIndex)]="selectedTabIndex" 
      class="bot-tabs">
      
      <!-- Вкладка 1: Инструкция по созданию -->
      <mat-tab [disabled]="!isTabEnabled(0)">
        <ng-template mat-tab-label>
          <div class="tab-label" [ngClass]="getTabStatus(0)">
            <mat-icon class="tab-icon">{{ getTabIcon(0) }}</mat-icon>
            <span>{{ getTabTitle(0) }}</span>
          </div>
        </ng-template>
        
        <div class="tab-content">
          <app-bot-creation-guide></app-bot-creation-guide>
          
          <div class="tab-navigation">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="goToNextStep()"
              class="next-button">
              Перейти к активации
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </div>
      </mat-tab>

      <!-- Вкладка 2: Активация бота -->
      <mat-tab [disabled]="!isTabEnabled(1)">
        <ng-template mat-tab-label>
          <div class="tab-label" [ngClass]="getTabStatus(1)">
            <mat-icon class="tab-icon">{{ getTabIcon(1) }}</mat-icon>
            <span>{{ getTabTitle(1) }}</span>
          </div>
        </ng-template>
        
        <div class="tab-content">
          <app-bot-token-input 
            [organizationId]="organizationId"
            (botActivated)="onBotActivated($event)">
          </app-bot-token-input>
          
          <div class="tab-navigation">
            <button 
              mat-stroked-button 
              (click)="goToPreviousStep()"
              class="back-button">
              <mat-icon>arrow_back</mat-icon>
              Назад к инструкции
            </button>
            
            <button 
              mat-raised-button 
              color="primary" 
              (click)="goToNextStep()"
              [disabled]="!botActivated"
              class="next-button">
              Перейти к настройкам
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </div>
      </mat-tab>

      <!-- Вкладка 3: Настройки бота -->
      <mat-tab [disabled]="!isTabEnabled(2)">
        <ng-template mat-tab-label>
          <div class="tab-label" [ngClass]="getTabStatus(2)">
            <mat-icon class="tab-icon">{{ getTabIcon(2) }}</mat-icon>
            <span>{{ getTabTitle(2) }}</span>
          </div>
        </ng-template>
        
        <div class="tab-content">
          <app-bot-settings 
            [organizationId]="organizationId"
            (settingsUpdated)="onSettingsUpdated()">
          </app-bot-settings>
          
          <div class="tab-navigation">
            <button 
              mat-stroked-button 
              (click)="goToPreviousStep()"
              class="back-button">
              <mat-icon>arrow_back</mat-icon>
              Назад к активации
            </button>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

</div>
