<div class="slots-management-container">
  <div class="header">
    <h1>üìÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–∞–º–∏</h1>
    <p class="subtitle">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏</p>
  </div>

  <div class="content">
    <mat-tab-group>
      <!-- –í–∫–ª–∞–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ—Ç–æ–≤ -->
      <mat-tab label="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤">
        <div class="tab-content">
          <mat-card class="generation-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>auto_awesome</mat-icon>
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤
              </mat-card-title>
              <mat-card-subtitle>
                –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ—Ç—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —É—Å–ª—É–≥–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <form [formGroup]="generationForm" class="generation-form">
                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>–£—Å–ª—É–≥–∞</mat-label>
                    <mat-select formControlName="serviceId" required>
                      <mat-option *ngFor="let service of services" [value]="service.id">
                        {{ service.name }} ({{ service.durationMin }} –º–∏–Ω)
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="generationForm.get('serviceId')?.hasError('required')">
                      –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline">
                    <mat-label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</mat-label>
                    <input matInput [matDatepicker]="startPicker" formControlName="startDate" required>
                    <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                    <mat-datepicker #startPicker></mat-datepicker>
                    <mat-error *ngIf="generationForm.get('startDate')?.hasError('required')">
                      –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</mat-label>
                    <input matInput [matDatepicker]="endPicker" formControlName="endDate" required>
                    <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                    <mat-datepicker #endPicker></mat-datepicker>
                    <mat-error *ngIf="generationForm.get('endDate')?.hasError('required')">
                      –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline">
                    <mat-label>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</mat-label>
                    <input matInput type="time" formControlName="startTime" required>
                    <mat-error *ngIf="generationForm.get('startTime')?.hasError('required')">
                      –£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</mat-label>
                    <input matInput type="time" formControlName="endTime" required>
                    <mat-error *ngIf="generationForm.get('endTime')?.hasError('required')">
                      –£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline">
                    <mat-label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞ (–º–∏–Ω—É—Ç—ã)</mat-label>
                    <input matInput type="number" formControlName="slotDuration" min="15" max="480" required>
                    <mat-error *ngIf="generationForm.get('slotDuration')?.hasError('required')">
                      –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞
                    </mat-error>
                    <mat-error *ngIf="generationForm.get('slotDuration')?.hasError('min')">
                      –ú–∏–Ω–∏–º—É–º 15 –º–∏–Ω—É—Ç
                    </mat-error>
                    <mat-error *ngIf="generationForm.get('slotDuration')?.hasError('max')">
                      –ú–∞–∫—Å–∏–º—É–º 480 –º–∏–Ω—É—Ç (8 —á–∞—Å–æ–≤)
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-checkbox formControlName="includeWeekends">
                    –í–∫–ª—é—á–∞—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏
                  </mat-checkbox>
                </div>

                <div class="form-row" *ngIf="!generationForm.get('includeWeekends')?.value">
                  <mat-form-field appearance="outline">
                    <mat-label>–ù–∞—á–∞–ª–æ –æ–±–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞</mat-label>
                    <input matInput type="time" formControlName="lunchBreakStart">
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>–ö–æ–Ω–µ—Ü –æ–±–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞</mat-label>
                    <input matInput type="time" formControlName="lunchBreakEnd">
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button 
                    mat-raised-button 
                    color="primary" 
                    (click)="generateSlots()"
                    [disabled]="generationForm.invalid || isGenerating"
                    class="generate-button">
                    <mat-icon *ngIf="!isGenerating">auto_awesome</mat-icon>
                    <mat-spinner *ngIf="isGenerating" diameter="20"></mat-spinner>
                    {{ isGenerating ? '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...' : '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã' }}
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- –í–∫–ª–∞–¥–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ—Ç–∞–º–∏ -->
      <mat-tab label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–∞–º–∏">
        <div class="tab-content">
          <div class="slots-header">
            <div class="slots-title-section">
              <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–ª–æ—Ç—ã</h3>
              <div class="counters" *ngIf="servicesCount > 1 || slotsCount > 1">
                <span class="counter" *ngIf="servicesCount > 1">
                  <mat-icon>business_center</mat-icon>
                  {{ servicesCount }} —É—Å–ª—É–≥
                </span>
                <span class="counter" *ngIf="slotsCount > 1">
                  <mat-icon>schedule</mat-icon>
                  {{ slotsCount }} —Å–ª–æ—Ç–æ–≤
                </span>
              </div>
            </div>
            <div class="slots-actions">
              <button 
                mat-stroked-button 
                color="warn"
                (click)="deleteAllSlots()"
                class="delete-all-button">
                <mat-icon>delete_sweep</mat-icon>
                –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã
              </button>
              <button 
                mat-stroked-button 
                (click)="loadSlots()"
                class="refresh-button">
                <mat-icon>refresh</mat-icon>
                –û–±–Ω–æ–≤–∏—Ç—å
              </button>
            </div>
          </div>

          <div *ngIf="isLoading" class="loading-container">
            <mat-spinner></mat-spinner>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ—Ç–æ–≤...</p>
          </div>

          <div *ngIf="!isLoading && slots.length === 0" class="empty-state">
            <mat-icon class="empty-icon">event_busy</mat-icon>
            <h3>–°–ª–æ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ—Ç—ã —Å –ø–æ–º–æ—â—å—é –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</p>
          </div>

          <div *ngIf="!isLoading && slots.length > 0" class="slots-table">
            <table mat-table [dataSource]="slots" class="mat-elevation-z2">
              <!-- –£—Å–ª—É–≥–∞ -->
              <ng-container matColumnDef="service">
                <th mat-header-cell *matHeaderCellDef>–£—Å–ª—É–≥–∞</th>
                <td mat-cell *matCellDef="let slot">{{ getServiceName(slot.serviceId) }}</td>
              </ng-container>

              <!-- –î–∞—Ç–∞ -->
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>–î–∞—Ç–∞</th>
                <td mat-cell *matCellDef="let slot">{{ formatDate(slot.startAt) }}</td>
              </ng-container>

              <!-- –í—Ä–µ–º—è -->
              <ng-container matColumnDef="time">
                <th mat-header-cell *matHeaderCellDef>–í—Ä–µ–º—è</th>
                <td mat-cell *matCellDef="let slot">
                  {{ formatTime(slot.startAt) }} - {{ formatTime(slot.endAt) }}
                </td>
              </ng-container>

              <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
              <ng-container matColumnDef="duration">
                <th mat-header-cell *matHeaderCellDef>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                <td mat-cell *matCellDef="let slot">{{ getDuration(slot.startAt, slot.endAt) }} –º–∏–Ω</td>
              </ng-container>

              <!-- –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å -->
              <ng-container matColumnDef="capacity">
                <th mat-header-cell *matHeaderCellDef>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</th>
                <td mat-cell *matCellDef="let slot">{{ slot.capacity }}</td>
              </ng-container>

              <!-- –°—Ç–∞—Ç—É—Å -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>–°—Ç–∞—Ç—É—Å</th>
                <td mat-cell *matCellDef="let slot">
                  <div class="slot-status" [ngClass]="getSlotStatusClass(slot)">
                    <mat-icon class="status-icon">{{ getSlotStatusIcon(slot) }}</mat-icon>
                    <span class="status-text">{{ getSlotStatusText(slot) }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- –î–µ–π—Å—Ç–≤–∏—è -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>–î–µ–π—Å—Ç–≤–∏—è</th>
                <td mat-cell *matCellDef="let slot">
                  <button 
                    mat-icon-button 
                    color="warn"
                    (click)="deleteSlot(slot.id)"
                    matTooltip="–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <!-- –ü–∞–≥–∏–Ω–∞—Ç–æ—Ä -->
            <mat-paginator
              [length]="totalCount"
              [pageSize]="pageSize"
              [pageIndex]="pageIndex"
              [pageSizeOptions]="pageSizeOptions"
              [showFirstLastButtons]="true"
              (page)="onPageChange($event)"
              class="slots-paginator">
            </mat-paginator>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
